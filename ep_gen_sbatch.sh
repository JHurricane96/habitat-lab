#! /usr/bin/env bash

set -x

# minitrain
# scenes=(
#     107734119_175999932. \
#     107734110_175999914. \
#     106365897_174225972. \
#     108736722_177263382. \
#     108294558_176710095. \
#     108294465_176709960. \
#     107733912_175999623. \
#     106879023_174887148. \
#     108294897_176710602. \
#     104348133_171513054. \
#     108736635_177263256. \
#     104348082_171512994. \
#     107734188_176000034. \
#     104862513_172226580. \
#     104862621_172226772. \
#     103997970_171031287. \
#     102344193. \
#     108294684_176710278. \
#     105515211_173104179. \
#     105515403_173104449. \
# )

# minival
scenes=(
    105515211_173104185. \
    108736689_177263340. \
    107734176_176000019. \
    102816216. \
    106879005_174887124. \
    107734338_176000244. \
    108736779_177263484. \
    106878858_174886965. \
)

num_scenes=${#scenes[@]}
export SPLIT=val
export NUM_EPISODES=400

mkdir -p ep_gen_logs/$SPLIT

# for i in {0..9}
# for i in {0..3}
# for i in {0..$((num_scenes-1))..4}
for (( i=0; i<$num_scenes; i+=4 ))
do
    export EP_GEN_IDX=$i
    # export SCENE=${scenes[i]}
    export SCENES="${scenes[@]:$i:4}"
    sbatch \
        --error "ep_gen_logs/${SPLIT}/slurm_${i}_%a.err" \
        --output "ep_gen_logs/${SPLIT}/slurm_${i}_%a.out" \
        --job-name ep_gen_${i} \
        ep_gen_node.sh
done
